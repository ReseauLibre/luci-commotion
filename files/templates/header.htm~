<%#
LuCI - Lua Configuration Interface
Copyright 2008 Steven Barth <steven@midlink.org>
Copyright 2008 Jo-Philipp Wich <xm@leipzig.freifunk.net>
Copyright 2012 David Menting <david@nut-bolt.nl>
Copyright 2013 Griffin Boyce <griffin@opentechinstitute.org>
Copyright 2013 Seamus Tuohy <s2e@opentechinstitute.org>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

-%>
<%
   local http = require "luci.http"
   local sys  = require "luci.sys"
   local disp = require "luci.dispatcher"
   local cdisp = require "luci.commotion.dispatch"
   local util = require "luci.util"

   
   -- send as HTML5
   http.prepare_content("text/html")

   hostname = sys.hostname()

   --The request path (eg. http://ipaddress/cgi-bin/luci/;id-string/THIS/THIS/THIS/)
   request  = disp.context.path
   local request2 = disp.context.request

   --ROOT NODE OF PATH (eg. admin on admin pages)
   category = request[1]

   --SAME AGAIN
   cattree  = category and disp.node(category)
   
   --leaf is length of request2
   local leaf = request2[#request2] 

   --Create a node of the local thread (the current context)
   tree = disp.node()

   --Show the local node (current menu) on the tree
   local node = disp.context.dispatched
   
   --An Ordered table of node names of this tree's child nodes
   local categories = disp.node_childs(tree)
   
   local c = tree
   local i, r

	-- tag all nodes leading to this page
   for i, r in ipairs(request) do
		if c.nodes and c.nodes[r] then
			c = c.nodes[r]
			c._menu_selected = true
		end
	end
   
   --nodeurl was here 
   --subtree was here 
   -%>
<!DOCTYPE html>
<html lang="<%=luci.i18n.context.lang%>">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=yes" />
    <title><%=striptags( hostname .. ( (node and node.title) and ' - ' .. translate(node.title) or '')) %> - LuCI</title>
    <!--[if lt IE 9]><script src="<%=media%>/html5.js"></script><![endif]-->
    <link rel="stylesheet" href="<%=media%>/cascade.css">
    <link rel="shortcut icon" href="<%=media%>/favicon.ico">
    <% if node and node.css then %>
    <link rel="stylesheet" href="<%=resource%>/<%=node.css%>">
    <% end -%>
    <script src="<%=resource%>/xhr.js"></script>
    <script src="<%=media%>/zepto.min.js"></script>
  </head>

  <body class="lang_<%=luci.i18n.context.lang%> <%- if node then %><%= striptags( node.title ) %><%- end %>">
	<header>

	  <%if request[2] == "commotion" then%><!--Start "Basic" Menu here -->
	  <h1>COMMOTION MENU HERE</h1>
	  <%else%> <!--End "Basic" menu here -->
	  <%include("themes/commotion/drop_menu", {controller=controller, cattree=cattree, category=category})%>
	  
	  <%include("themes/commotion/toggle_header", {hostname=hostname})%>
	</header>
	
	  <!--<%include("themes/commotion/unsaved_changes", {tree=tree, controller=controller, category=category})%>-->


	  <%end%> <!--End Regular Menu-->

    <div class="navbar-inners"><div class="color0"></div><div class="color1"></div><div class="color2"></div><div class="color3"></div><div class="color4"></div></div>
		<!--Do we want the pretty colors in the new UI? If not move into the last lua statment above.-->

	<% if request[2] == "commotion" then%><!--Start "Basic" SIDEBAR here -->

<div class="sb-container">
<div class="sb-btn"><h1>Status</h1></div>
<div class="sb-content">
  <div class="sb-content-inner">
    <p class="submenutitle">This is the submenu title</p>
    <ul class="submenu">
        <li>Cats</li>
        <li>Cats</li>
        <li>Cats</li>
        <li>Meow</li>
    </ul>
  </div>
</div>

<div class="sb-btn"><h1>Basic Config</h1></div>
<div class="sb-content">
  <div class="sb-content-inner">
    <p>Nulla facilisi. Proin sodales dolor</p>
  </div>
</div>

<div class="sb-btn"><h1>Client Controls</h1></div>
<div class="sb-content">
  <div class="sb-content-inner">
    <p>Praesent ultricies risus quis magna convallis, ac condimentum tellus laoreet. Donec dictum velit enim, nec hendrerit leo mattis sit amet.</p>
  </div>
</div>

<div class="sb-btn"><h1>Applications</h1></div>
<div class="sb-content">
  <div class="sb-content-inner">
    <p>Fusce eget ultricies ante. In augue urna, rhoncus ac tellus non, porta malesuada magna. Nulla tincidunt orci in metus rhoncus, at malesuada quam varius. Mauris sed tincidunt massa, ut cursus magna. Pellentesque cursus sapien turpis, id blandit magna tempus at.</p>
  </div>
</div>
<div class="sb-btn"><h1>Security</h1></div>
<div class="sb-content">
  <div class="sb-content-inner">
    <p>Fusce eget ultricies ante. In augue urna, rhoncus ac tellus non, porta malesuada magna. Nulla tincidunt orci in metus rhoncus, at malesuada quam varius.</p>
  </div>
</div>

<div class="sb-btn"><h1>Advanced</h1></div>
<div class="sb-content">
  <div class="sb-content-inner">
    <p>Fusce eget ultricies ante. In augue urna, rhoncus ac tellus non, porta malesuada magna. Nulla tincidunt orci in metus rhoncus, at malesuada quam varius. Mauris sed tincidunt massa, ut cursus magna. Pellentesque cursus sapien turpis, id blandit magna tempus at.</p>
  </div>
</div>
</div>


  <nav>
    <ul id="navtoselect">
      <%-
		 local util = require "luci.util"
		 local http = require "luci.http"
		 local disp = require "luci.dispatcher"
		 
         local function submenu(prefix, node)
         local childs = disp.node_childs(node)
         if #childs > 0 then
      %>
      <ul class="dropdown-menu">
        <%-
           for i, r in ipairs(childs) do
           local nnode = node.nodes[r]
           local href  = controller .. prefix .. r ..
           (nnode.query and http.build_querystring(nnode.query) or "")
           %>
        <li>
          <a href="<%=util.pcdata(href)%>"><%=util.pcdata(striptags(translate(nnode.title)))%></a>
        </li>
        <%-
           end
           %>
      </ul>
      <%-
         end
         end
		 
         childs = disp.node_childs(cattree)
		 
         if #childs > 0 then
      for i, r in ipairs(childs) do
      local nnode = cattree.nodes[r]
      local href  = controller .. "/" .. category .. "/" .. r ..
      (nnode.query and http.build_querystring(k.query) or "") --Where is k defined?
      local grandchildren = disp.node_childs(nnode)
	  
      if #grandchildren > 0 then
      %>
      <li class="dropdown">
        <a class="menu" href="<%=util.pcdata(href)%>"><%=util.pcdata(striptags(translate(nnode.title)))%></a>
        <%- submenu("/" .. category .. "/" .. r .. "/", nnode) %>
      </li>
      <% else %>
      <li>
        <a href="<%=util.pcdata(href)%>"><%=util.pcdata(striptags(translate(nnode.title)))%></a>
      </li>
      <%
         end
         end
         end
         %>
    </ul>
  </nav>


	<%end%> <!--End "Basic" SIDEBAR here -->
	
    <section id="maincontent">
	  <%include("themes/commotion/subtree", {controller=controller, category=category, cattree=cattree})%>
